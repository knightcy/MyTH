!function(){Framework={},(n={}).ErrorCode=Ee={100001:"Wrong Password or Wrong user",100002:"User does not exist",100003:"Without logging in",100004:"Illegal request",100005:"Login over time!Please relogin",100006:"Account has been locked for a period of time，Please try again later",11e4:"DB cause an error",100050:"Permission denied",100060:"Permission denied: Illegal IP request",100100:"There is not the module or method",100200:"The size of each file should be less than 10MB",100201:"File format error!",100202:"Form pase error:",100300:"sendEmail error",200001:"The user name is exist",300001:"DB error",400001:"There is no BizBox middle service setting.",500001:"Sorry,You have no legal power",500002:"Auth code is invalid",500200:"Register Error"},n.ActionStatus={S:1,F:0},n.defaultUser={System:"System"},n.EventType={EventsOccur:"EventsOccur",MailCreated:"MailCreated",UpdateSession:"updateSession",Signin:"signin",Signout:"signout",Signup:"signup",ServerProChanged:"ServerProChanged",ServerDataAdded:"ServerDataAdded",AcquireSuccess:"acquireSuccess",AcquireFailed:"acquireFailed",AddServer:"addServer",DeleteServer:"deleteServer",UpdateServer:"updateServer",Warning:"warning",CreateService:"createService",StartService:"startService",StopService:"stopService",UpdateService:"updateService",DeleteService:"deleteService",UpdateModel:"updateModel",ServerStorageWarning:"ServerStorageWarning"},n.ServerMonitorDataType={cpuStatusData:"cpuStatusData",memoryStatusData:"memoryStatusData",netStatusData:"netStatusData"},n.monitorType={cpuUr:"cpu_ur",memoryUr:"memory_ur",memoryUsed:"memory_used",netIn:"net_in",netOut:"net_out",netTotal:"net_total"},n.ContractType={BB2Cloud:"bb2cloud",EBPClound:"cloud",Custom:"custom"},Framework.Consts=n;var r,n=Framework.Consts,e={},a=require("util"),t=require("os"),o=require("fs"),u=require("crypto"),c=function(e){return null==e||null==e||"undefined"==e||"null"==e},l=function(e,t){for(var r in t||(t={}),e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},f=function(e,t){var r,n,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||10,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n]);return i.join("")},d=function(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array)return e.slice();if(e instanceof Object){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=d(e[r]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},h=function(e,t){return Math.random()*(t-e+1)+e},g=!1,p=function(e,t){var r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t},v=function(e,t){return p(e,"yyyyMMddhhmmss")+f(t)};global.instances={};var m=function(e,t,r){var n,o,i;try{n=e.toString().split(".")[1].length}catch(e){n=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}switch(i=Math.pow(10,Math.max(n,o)),r){case"add":return(e*i+t*i)/i;case"subtract":return(e*i-t*i)/i;case"multiply":return e*i*(t*i)/(i*i)}},y=function(e,t){e.status=0,e.error={cause:n.ErrorCode[300001],desc:t.message?t.message:t.desc,code:"300001"},console.log(e.error.cause+" :"+e.error.desc)};e.compareByProperty=function(o){return function(e,t){var r=e[o],n=t[o];return isNaN(Number(r))||isNaN(Number(n))||(r=Number(r),n=Number(n)),r<n?-1:n<r?1:0}},e.secondtotime=function(e){var t=e%86400,r=t%3600;return{day:parseInt(e/86400),hours:parseInt(t/3600),minute:parseInt(r/60),second:r%60}},e.wrapDBErrorAction=y,e.responsDBErrorAction=function(e,t,r){y(t,r),e.json(t)},e.formatDateUTC=function(e,t){e.getUTCMonth();var r={"M+":e.getUTCMonth()+1,"d+":e.getUTCDate(),"h+":e.getUTCHours(),"m+":e.getUTCMinutes(),"s+":e.getUTCSeconds(),"q+":Math.floor((e.getUTCMonth()+3)/3),S:e.getUTCMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getUTCFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t},e.formatFloat=m,e.formatFloatWithDecimalDigits=function(e,t,r,n){return m(e,t,n).toFixed(r)},e.getGUID=f,e.isNull=c,e.copySimpleObject=l,e.clone=d,e.isRole=function(e,t){return 0!=(e&t)},e.getRandom=h,e.getRandomInt=function(e,t){return Math.floor(h(e,t))},e.calculateRole=function(e){for(var t=0,r=0;r<e.length;r++)t|=n.Role[e[r]];return t},e.calculateRoleValue=function(e){var t=[];for(var r in n.Role)0!=(e&n.Role[r])&&t.push(r);return t},e.hasFunctionOfRole=function(e){var t=autorize.FunctionOfRole,r=[];for(var n in t){var o=t[n];a.isNumber(o)&&0!=(o&e)&&r.push(n)}return r},e.enableDebug=function(){g=!0},e.disableDebug=function(){g=!1},e.log=function(e){g&&console.log(e)},e.formatDate=p,e.getBeforeDate=function(e){var t=e,r=new Date,n=r.getFullYear(),o=r.getMonth()+1,i=r.getDate();return i<=t&&(1<o?o-=1:(n-=1,o=12)),r.setDate(r.getDate()-t),n=r.getFullYear(),o=r.getMonth()+1,i=r.getDate(),s=n+"-"+(o<10?"0"+o:o)+"-"+(i<10?"0"+i:i),s},e.getAfterTimeWithFormat=function(e,t){var r=(new Date).getTime();return p(new Date(r+24*e*60*60*1e3),t)},e.cacheConfig=function(e){r=e},e.getConfigure=function(e,t){return r},e._handleDatatableSettings=function(e,r){if(e.info&&(e=e.info),e instanceof Array){var n={};return e.forEach(function(t){"sEcho"==t.name&&(n.sEcho=t.value),"iDisplayStart"==t.name&&(n.start=t.value),"iDisplayLength"==t.name&&(n.length=t.value),"sSearch"==t.name&&(n.sSearch=t.value),"iSortCol_0"==t.name&&(n.iSortCol_0=t.value),"sSortDir_0"==t.name&&(n.sSortDir_0=t.value),"mDataProp_0"==t.name&&(n.mDataProp_0=t.value),-1<t.name.indexOf("mDataProp_")&&(n[t.name]=t.value),r&&r.forEach(function(e){t.name==e&&(n[e]=t.value)})}),n}if(e instanceof Object)return e},e.extend=function(e,t,r){for(var n in c(r)&&(r={},l(e.prototype,r)),e.superClass=t,e.prototype=function(e){if(null==e)throw TypeError();if(Object.create)return Object.create(e);var t=typeof e;if("object"!==t&&"function"!==t)throw TypeError();function r(){}return r.prototype=e,new r}(t.prototype),e.prototype.constructor=e,r)e.prototype[n]=r[n]},e.callSuper=function(e,t,r){e.superClass.apply(t,r)},e.invokeSuper=function(e,t,r,n){var o=e.superClass[t];if(o||(o=e.superClass.prototype[t]),o)return o.apply(r,n)},e.dynamicLoad=function(e){o.readdirSync(__dirname).forEach(function(e){require(e)})},e.loadSingleInstance=function(e,t,r,n){if(e){var o=global.instances[e];return!o&&r?(o=Framework[r])&&(n&&(o=new o),global.instances[e]=o):!o&&t&&(o=require(t))&&(n&&(o=new o),global.instances[e]=o),o}return null},e.getTimeGUID=v,e.getAfterTime=function(e){var t=(new Date).getTime();return new Date(t+24*e*60*60*1e3).toLocaleString()},e.isPowerOf2=function(e){return 0==(e&e-1)},e.generateEvent=function(e,t,r,n){var o=new Date;return{eventid:v(o,10),type:e,event:t,time:o,operator:r,desc:n}},e.getMD5=function(e){var t=u.createHash("md5");t.update(e);var r=t.digest("hex");return console.log("utilities,getMD5 "+e+" : "+r),r},e.setWithDefaultRef=function(e,t){if(!t)return e;for(var r in e||(e={}),t)t.hasOwnProperty(r)&&(e[r]||(e[r]=t[r]));return e},e.getNodeClientIp=function(e){var t,r=e.headers;if(r&&r["x-forwarded-for"]&&(t=r["x-forwarded-for"]),!t){var n=e.connection;if(n){var o=n.socket;n.remoteAddress?t=n.remoteAddress:o&&o.remoteAddress&&(t=o.remoteAddress)}}t||(o=e.socket)&&o.remoteAddress&&(t=o.remoteAddress);return t||"127.0.0.1"},e.getOffsetDays4=function(e,t){var r=t.getTime()-e.getTime();return Math.floor(r/864e5)},e.getOS=function(){return t.type()},e.PrefixInteger=function(e,t){return(Array(t).join("0")+e).slice(-t)},e.prefixInteger=function(e,t){return(e/Math.pow(10,t)).toFixed(t).substr(2)},e.randString=function(e,t){var r=["abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ","1234567890","@#$%&*"],n=function(e,t){return Math.floor(Math.max(e,Math.random()*(t+1)))},o=n(e,t),a="";for(i=0;i<o;i++){var s=n(0,3);a+=r[s].charAt(n(0,r[s].length))}return a},e.renderTemplate=function(e,t){var o=t,i="";return e.forEach(function(t){var r,n=o;Object.keys(t).forEach(function(e){r=new RegExp("\\{{"+e+"\\}}","g"),n=n.replace(r,t[e])}),i+=n}),i},e.getCronDate=function(e){e.getFullYear();var t=e.getMonth(),r=e.getDate(),n=e.getHours(),o=e.getMinutes(),i=e.getSeconds();Math.floor((e.getMonth()+3)/3),e.getMilliseconds();return i+" "+o+" "+n+" "+r+" "+t+" *"},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1},Array.prototype.find=function(e,t){for(var r=[],n=0;n<this.length;n++){var o=this[n];t===o[e]&&r.push(o)}return r},Array.prototype.removeByV=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)},Array.prototype.removeByIndex=function(e){-1<e&&this.splice(e,1)},Date.prototype.DateAdd=function(e,t){var r=this;switch(e){case"s":return new Date(Date.parse(r)+1e3*t);case"m":return new Date(Date.parse(r)+6e4*t);case"h":return new Date(Date.parse(r)+36e5*t);case"D":return new Date(Date.parse(r)+864e5*t);case"W":return new Date(Date.parse(r)+6048e5*t);case"q":return new Date(r.getFullYear(),r.getMonth()+3*t,r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());case"M":return new Date(r.getFullYear(),r.getMonth()+t,r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());case"Y":return new Date(r.getFullYear()+t,r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds())}},Framework.Utilities=e;var b=Framework.RSAUtils,S=require("crypto"),w={encrypteWithPWD:function(e){var t=e.pwd||"Benbangtu2017",r=e.plainText,n=e.inputFormat||"utf8",o=e.outputFormat||"base64",i=S.createCipher("aes192",t),a=i.update(r,n,o);return a+=i.final(o)},decrypt:function(e,r){b.decryptWithPrivateKey("-----BEGIN RSA PRIVATE KEY-----\n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\n-----END RSA PRIVATE KEY-----\n",e,function(e,t){t?r(null,t):r(e)})},encrypt:function(e,r){b.encryptWithPublicKey("-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA580bEYYS6yc+mbFVik0f\n2pCkUmncrFXcvTP7nmrvxsrIrxteGI4jGfWIk7FalcjbWgcyQAY+ioghTMp2XUT/\nolGEJyEzzaf3tfgbL3T8hETRRLZkfwnLcElw03YDcTvlyofG492WajXu1xkO//sy\nMv7fA7ZZ1hmSKa4/mlsepJKyKywkyF6k0FBqBVUqv3uOg7FMI5271AIX0GsBMgJP\nMW0mNEDMAgjEIbytBOdHre2CqMSUivXn6QOeCKjXuZv2hA1n3FQICkKl9jH4etOh\nozDcS/QUXC7EXklYTbWj89pbJic1PFa2IQOVrGhctRi1EKhisJJ55HuyZBbriUGB\nCweLEZiMQAkiS06jJK1SaVKf7WHkh7K5yfpWpop8rgqUVTDBI6agODBrBAh7StOX\nYouWvbUQLfOVBXhxJ3hvArPdsglzOSlZAfB/T6uFJEoMZZ5PP/a6QYu51x92bePO\nEhWVBROrBGA1SJmkT9PoYOxH5mnG1b1YAPh8bQsbaapYWbzoyS6QYxrCU7iEjgrd\nQTrBwWvVDF/3qIQNJ+1p7XfPUCfH8bod+nduEZW2qyLg5UY8A/LEwOuwlKo5aWNB\nTZymD8S7kvxrkLyT14y4czmmQYCwF/tkaZiUrm2FQSFaC7xQpL09t2mTqhp6d2YX\nQcbhqil8PKOafNGkUPOI9tsCAwEAAQ==\n-----END PUBLIC KEY-----\n",e,function(e,t){t?r(null,t):r(e)})}};Framework.Crypto=w;S=require("crypto");var E={generateDHKeys:function(e){(e=e||{}).primeLength=e.primeLength||60;var t=e.primeLength,r=S.createDiffieHellman(t);r.generateKeys("base64");var n={public:r.getPublicKey("base64"),private:r.getPrivateKey("base64")};console.log(JSON.stringify(n)),console.log(JSON.stringify({public:r.getPublicKey("hex"),private:r.getPrivateKey("hex")}))},encryptWithPublicKey:function(e,t,r){var n=new Buffer(t);try{var o=S.publicEncrypt(e,n);return o?(r(o.toString("base64")),o.toString("base64")):(r(null,new Error("encrypted error!")),null)}catch(e){return r&&r(null,e),null}},decryptWithPrivateKey:function(e,t,r){var n=new Buffer(t,"base64");try{var o=S.privateDecrypt(e,n);o?r(o.toString("utf8")):r(null,new Error("decrypted error!"))}catch(e){r&&r(null,e)}},verify:function(e,t,r,n){var o=S.createVerify(e);return o.update(new Buffer(r,"utf-8")),o.verify(t,n,"base64")},sign:function(e,t,r,n){var o=S.createSign(e);o.update(r,"utf8");var i=o.sign(t);if(n){for(var a=i.length,s=[],u=0;u<a;u++)s.push(i.readInt8(u));return s}return i},signBB2License:function(e){return this.sign("RSA-SHA1","-----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQCuokFwiIBsSm5vVrGz9c6yiCGaz6i9XcB+Tzc87XA/8rF/tO8O\ny104ekMeIhvNkjGb9ATm8egZUuEIXvn5Z7X3XnLUz0NjMttYmsEN4/hy+AHzLgzu\ne3/Q0dxqJkQXtNqxAs911kNyGOmGnqfXud6P3i86b1zFc/43XTp3fjJNZQIDAQAB\nAoGAAMcwS3QQPmtGerCEMi0SMrFwlOP/+HgGd4ma0WatbVuDdvIzbnlxfOLukZ/N\nR+ky12MK8ox5YEOCRStHKdlQcjvSCzAAdYTJIXRmZ13DCgPEnCYvq1Wjd/z4DQZr\nrd2MaD4l4EjBTgXnDSbXq6teNxPGOWRMBpG41X/jMrPQfAECQQDiRRC4s0BdXD3G\n08E2P08tLtfTlWTDrzCEXYOzRhv7Qri7sgpQZgLr51ralDy7IYneSHEI1OZwlEZg\njsxBdIKlAkEAxZRVlR6Vd/7k4hQUbH24IDHdSReFEIkQI2EY4pgIrRSlYU/j9LDq\nnEkjF4UhGSQVyihk/5bkfq1BAxKakZ5jwQJBAN4BgcyXI7n2fS6OKe6940OjyGNz\nGzDcvS/CSSwmx+GZr4OJxpDn5knr77qy43uABrOwRCe0LH2dHggzU7mNRXkCQGSh\nVzF7AT+7mBG5jmlvYq8rFnyauRAh7xFF6+nE625T/KNikETZMrTk3zWkfaYTZfGv\nvzkaPkhyr5EEEaunE0ECQQCfh6JM3gqIHncJS4NHitEON6kXX6fJBx+WW4r7gBQr\nahCVrKBXF92IrZTpUr09fFyxmUSiGa7+tbpSIRCKDWTN\n-----END RSA PRIVATE KEY-----\n",e,!0)},showcryptoTypes:function(){console.log(S.getHashes())}};Framework.RSAUtils=E;var C=require("mssql"),M=Framework.Utilities,A=require("async"),F=function(e){this.init(e),this.direction={Input:"input",Output:"output",Return:"return"}};M.extend(F,Object,{init:function(e){this.config={user:e.user,password:e.password,server:e.host,database:e.database,stream:!1,pool:{min:0,idleTimeoutMillis:3e3}}},execute:function(r,a,s){var u=this;try{var n=new C.ConnectionPool(u.config,function(e){if(e)s(e);else{var i=new C.Request(n);if(null!=a)for(var t in a)a[t].direction==u.direction.Output?i.output(t,a[t].sqlType):i.input(t,a[t].sqlType,a[t].inputValue);i.execute(r,function(e,t,r,n){if(e)s(e);else{for(var o in a)a[o].direction==u.direction.Output&&(a[o].outputValue=i.parameters[o].value);s(e,t,r,n)}})}});n.on("error",s)}catch(e){s(e)}},queryWithParams:function(n,o,i){try{var a=new C.ConnectionPool(this.config,function(e){if(e)i(e);else{var t=new C.Request(a);if(t.multiple=!0,o)for(var r in o)t.input(r,o[r].sqlType,o[r].inputValue);t.query(n,i)}});a.on("error",i)}catch(e){i(e)}},query:function(e,t){this.queryWithParams(e,null,t)},bulkInsert:function(t,r){try{if(t){var n=new C.ConnectionPool(this.config,function(e){e?r(e):new C.Request(n).bulk(t,r)});n.on("error",r)}else r(new ReferenceError("table parameter undefined!"))}catch(e){r(e)}},execSqlWithTrans:function(t,a){try{if(t)var r=new C.ConnectionPool(this.config,function(e){if(e)a(e);else{var i=new C.Transaction(r);i.begin(function(e){if(e)a(e);else{var r=[],n=!1;i.on("rollback",function(e){console.log("监听回滚"),console.log("aborted值 :",e),n=!0}),i.on("commit",function(){console.log("监听提交"),n=!0});var o=new C.Request(i);t.forEach(function(t){r.push(function(r){var e=t;o.query(e,function(e,t){e?(console.log("语句执行失败"),r(e,null)):(console.log("语句执行成功"),r(null,t))})})}),A.series(r,function(t,e){t?(console.log("出现错误,执行回滚"),n||i.rollback(function(e){e?(console.log("rollback err :",e),a(e)):(console.log("回滚成功"),a(t))})):(console.log("无错误,执行提交"),i.commit(function(e){e?(console.log("commit err :",e),a(e)):(console.log("提交成功"),a(null,"success"))}))})}})}});else a(new ReferenceError("没有传入sql语句"))}catch(e){a(e)}},queryViaStreamWithParams:function(n,o,i){try{this.config.stream=!0,C.connect(this.config,function(e){if(e)i.error(e);else{var t=new C.Request;if(t.stream=!0,o)for(var r in o)t.input(r,o[r].sqlType,o[r].inputValue);t.query(n),t.on("recordset",function(e){i.columns(e)}),t.on("row",function(e){i.row(e)}),t.on("error",function(e){i.error(e)}),t.on("done",function(e){i.done(e)})}}),C.on("error",i.error)}catch(e){i.error(e)}finally{this.config.stream=!1}},queryViaStream:function(e,t){this.queryViaStreamWithParams(e,null,t)}}),Framework.MSSQL=F;var D=require("mysql"),k=function(e){this.init(e)};(M=Framework.Utilities).extend(k,Object,{init:function(t){var r=this;this.release(function(e){e?console.log("Failed to release MySQL pool. "):r.initPool(t)})},initPool:function(e){var t={host:e.host,user:e.user,password:e.password,database:e.database,connectionLimit:e.connectionLimit||5};this.pool=D.createPool(t)},release:function(e){this.pool?this.pool.end(e):e()},query:function(t,r,o){this.pool.getConnection(function(e,n){e?o(e):n.query(t,r,function(e,t,r){n.release(),o(e,t,r)})})},update:function(t,r,o){this.pool.getConnection(function(e,n){e?o(e):n.query(t,r,function(e,t,r){n.release(),o(e,t,r)})})},insert:function(t,r,o){this.pool.getConnection(function(e,n){e?o(e):n.query(t,r,function(e,t,r){n.release(),o(e,t,r)})})},batchInsert:function(c,l,f,d){this.pool.getConnection(function(e,n){if(e)d(e);else{var t="insert into "+c,r="(",o="";if(l instanceof Array||(l=[l]),0<l.length){for(var i=0;i<l.length;i++){var a="(";if(0==i){var s=l[0];for(var u in s)r+=u+",","string"==typeof s[u]?a+="'"+s[u]+"',":a+=s[u]+",";r=r.substr(0,r.length-1)+") "}else{s=l[i];for(var u in s)"string"==typeof s[u]?a+="'"+s[u]+"',":a+=s[u]+","}o+=(a=a.substr(0,a.length-1)+")")+","}t+=r+" values "+(o=o.substr(0,o.length-1))+";",n.query(t,f,function(e,t,r){n.release(),e?d(e):d(null,t,r)})}else n.release(),d()}})},delete:function(t,r,o){this.pool.getConnection(function(e,n){e?o(e):n.query(t,r,function(e,t,r){n.release(),o(e,t,r)})})},isTableExist:function(e,t,r){var n="select TABLE_NAME from INFORMATION_SCHEMA.TABLES where TABLE_SCHEMA='"+t+"' and TABLE_NAME='"+e+"';";this.query(n,null,r)}}),Framework.MySQL=k;var T=require("node-neo4j"),q=function(e){this.init(e)};Framework.Utilities.extend(q,Object,{init:function(e){e||(e={host:"192.168.1.83",port:7474,user:"dong",password:"dong"}),this.db=new T("http://"+e.user+":"+e.password+"@"+e.host+":"+e.port)},getJsonFromNeo4jResult:function(e){for(var t=e.columns,r=e.data,n=[],o=0;o<r.length;o++){for(var i={},a=0;a<t.length;a++)i[t[a]]=r[o][a];n.push(i)}return n},query:function(e,t,r){var n=this;this.db.cypherQuery(e,t,function(e,t){t&&(1<t.columns.length&&(t=n.getJsonFromNeo4jResult(t)));r(e,t)})},getNodeFromKey:function(e,r){var n=this;e.key?this.query("START n=node({key})\nreturn n as node",e,function(e,t){t&&(t=n.getJsonFromNeo4jResult(t)),r(e,t)}):r(new Error("params error!"),null)},createNode:function(e,r){var t=e.labels,n=e.properties;this.db.insertNode(n,t,function(e,t){e?r(e):r(null,t)})},createRelationById:function(e,r){var t=e.root_node_id,n=e.other_node_id,o=e.type,i=e.typeValues;this.db.insertRelationship(t,n,o,i,function(e,t){e&&r(e),r(null,t)})},createRelationByNode:function(e,r){this.query(" UNWIND {data} as data  MATCH (n:"+e.rootNodeLabel+"{data.rootNodeParams})  MERGE (m:"+e.otherNodeLabel+"{data.otherNodeParams}) with m  MERGE (n)-[:"+e.relationType+"{data.relationValues}]->(m)",{data:e},function(e,t){e&&r(e),r(t)})},createConstraint:function(e,r){var t=e.label,n=e.uniqueParam;this.query("CREATE CONSTRAINT ON (a:"+t+") ASSERT a."+n+" IS UNIQUE",{},function(e,t){e&&r(e),r(null,t)})},update:function(e,r){var t=e.nodeLabelName,n=e.updateDataInfo,o=e.params;this.db.updateNodesWithLabelsAndProperties(t,o,n,function(e,t){e?r(e):r(null,t)})},upsetNode:function(e,r){var n=this,o=e.nodeLabelName,i=e.updateDataInfo,a=e.params;n.db.readNodesWithLabelsAndProperties(o,a,function(e,t){e?r(e):0<t.length?n.db.updateNodesWithLabelsAndProperties(o,a,i,function(e,t){e?r(e):r(null,{data:t,types:"update"})}):n.db.insertNode(i,o,function(e,t){e?r(e):r(null,{data:t,types:"insert"})})})},queryWithTrans:function(n,o,i,a){var s=this;if(i&&"function"!=typeof i){var e=[];e.push({statement:n,parameters:o||{}}),s.db.addStatementsToTransaction(i,{statements:e},function(e,t){if(t){var r=t.errors,n=t.results;if(0==r.length){var o={transactionId:i,result:0<n.length?t:""};a(null,o)}else a(r)}})}else s.beginTransaction(function(e,t){if(t)if(0==t.errors.length){i=t._id;var r=[];r.push({statement:n,parameters:o||{}}),s.db.addStatementsToTransaction(i,{statements:r},function(e,t){if(t){var r=t.errors,n=t.results;if(0==r.length){var o={transactionId:i,result:0<n.length?t:""};a(null,o)}else a(r)}})}else a(e)})},beginTrans:function(o){this.db.beginTransaction(function(e,t){if(t){var r=t.errors;if(0==r.length){var n=t._id;o(null,n)}else o(r)}else o("Error")})},commitTrans:function(e){this.db.commitTransaction(e,function(e,t){return t})},rollbackTrans:function(e){this.db.rollbackTransaction(e,function(e,t){return t})},testTrans:function(){var n=this;n.beginTrans(function(e,r){r&&n.queryWithTrans(" create (n:AAA{assetId:'ASS2112999'})",{},r,function(e,t){e?n.rollbackTrans(r):n.queryWithTrans("create (n:asset{assetId:'ASS21126364'})",{},r,function(e,t){e?n.rollbackTrans(r):n.commitTrans(r)})})})},registerModels:function(e,t,r){}}),Framework.Neo4j=q;var O,x,P,I={};I.init=function(e){var t=require("sequelize"),r=(Framework.Utilities,e.master),n={host:r.host,port:r.port,dialect:r.dialect,pool:{maxConnections:10,minConnections:0,maxIdleTime:1e7},logging:r.logging};if(O=new t(r.database,r.user,r.password,n),I.seq=O,"mysql"==r.dialect){var o=Framework.MySQL;x=new o(r),I.mysqlAccess=x}else if("mssql"==r.dialect){var i=Framework.MSSQL;P=new i(r),I.mssqlAccess=P}if(e.neo4j){var a=Framework.Neo4j;neo4j=new a(e.neo4j),I.neo4jAccess=neo4j}},I.query=function(e,t,r,n){var o=B[e];o?o.findAll(t).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)}):n&&n(new Error("SequelizeModel can not find the table for "+e))},I.insert=function(e,t,r,n){var o=B[e];o&&(t?o.create(t).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)}):n&&n({cause:"300001",desc:"empty insert data!"}))},I.upsert=function(e,t,r,n){var o=B[e];o&&(t?o.upsert(t).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)}):n&&n({cause:"300001",desc:"empty insert data!"}))},I.batchInsert=function(e,t,r,n){var o=B[e];if(o)if(0<t.length)if(1e3<=t.length){var i=parseInt(t.length/1e3);0<t.length%1e3&&i++;for(var a=0;a<i;a++)a==i-1?o.bulkCreate(t.slice(1e3*a,t.length)).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)}):o.bulkCreate(t.slice(1e3*a,1e3*(a+1))).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})}else o.bulkCreate(t).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)});else n&&n({cause:"300001",message:"empty insert data!",desc:"empty insert data!"})},I.isExist=function(e,t){},I.update=function(e,t,r,n,o){var i=B[e];i&&i.update(t,{where:r}).then(function(e){n&&n(e)}).error(function(e){o&&o(e)}).catch(function(e){o&&o(e)})},I.delete=function(e,t,r,n){var o=B[e];o&&o.destroy({where:t}).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})},I.insertFromSql=function(e,t,r,n){O.query(e,{replacements:t,type:O.QueryTypes.INSERT}).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})},I.queryFromSql=function(e,t,r,n){O.query(e,{replacements:t,type:O.QueryTypes.SELECT}).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})},I.updateFromSql=function(e,t,r,n){O.query(e,{replacements:t,type:O.QueryTypes.UPDATE}).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})},I.deleteFromSql=function(e,t,r,n){O.query(e,{replacements:t,type:O.QueryTypes.DELETE}).then(function(e){r&&r(e)}).error(function(e){n&&n(e)}).catch(function(e){n&&n(e)})},I.insertWithTrans=function(e,t,r){var n=B[e];if(n&&t)return n.create(t,{transaction:r})},I.batchInsertWithTrans=function(e,t,r){var n=B[e];if(n&&t)return n.bulkCreate(t,{transaction:r})},I.batchInsertWithTrans2=function(e,t,r){var n=B[e];if(n&&0<t.length){var o={};if(1e3<=t.length){var i=parseInt(t.length/1e3);0<t.length%1e3&&i++;for(var a=0;a<i;a++)o=a==i-1?n.bulkCreate(t.slice(1e3*a,t.length),{transaction:r}):n.bulkCreate(t.slice(1e3*a,1e3*(a+1)),{transaction:r})}else o=n.bulkCreate(t,{transaction:r});return o}},I.deleteWithTrans=function(e,t,r){var n=B[e];if(n)return n.destroy({where:t,transaction:r})},I.updateWithTrans=function(e,t,r,n){var o=B[e];if(o)return o.update(t,{where:r,transaction:n})},I.upsertWithTrans=function(e,t,r){var n=B[e];if(n)return n.upsert(t,{transaction:r})},I.queryWithTrans=function(e,t,r){var n=B[e];n&&n.findAll({where:t,transaction:r})},I.getNewSqlParamEntity=function(e,t,r){return r?r(null,{sql:e,params:t}):{sql:e,params:t}};var B={},R={count:0,target:0,pin:function(){this.count++},updateTarget:function(){this.target++}};I.tables=B,I.registerModel=function(e,t,r,n,o){B[e]||(n?(B[e]=O.define(t,r,{charset:"utf8",collate:"utf8_general_ci",timestamps:!1}),B[e].sync().then(function(){o&&o()})):(B[e]=O.define(t,r,{charset:"utf8",collate:"utf8_general_ci",timestamps:!1}),R.updateTarget()))},I.mysqlAccess=x;I.onReady=function(e){if(0==R.target||R.count>=R.target)e&&e();else for(var t in B)B[t].sync().then(function(){R.pin(),R.count==R.target&&e&&e()})},Framework.SequelizeModel=I;var _=require("child_process").exec,j=(M=Framework.Utilities,require("fs")),N={};N.readBusinessLicense=function(e,n){M.getOS();var t,r,o,i,a="bl"+M.getGUID(1e4,2e4)+".temp";r=function(r,e){var t,a;e?n(""):(t=r.params,a=function(e,t){j.unlink(r.filePath,function(e){e?console.log("Faile to remove BASE64 cache "+r.filePath):console.log("Remove BASE64 cache "+r.filePath)}),n&&n(e,t)},_("curl "+t,function(e,t,r){if(null!==e)console.log("exec error: "+e),a&&a(null,e);else{var n=t.indexOf('{"outputs'),o=t.substr(n),i=JSON.parse(o).outputs[0].outputValue;console.log(i),a&&a(i)}}))},o={inputs:[{image:{dataType:50,dataValue:e}}]},i="curl -i -k '"+"https://dm-58.data.aliyun.com/rest/160601/ocr/ocr_business_license.json"+"'  -H 'Authorization:APPCODE "+"cc6666c7beee44ffb854083bb2704ab3"+"'",i+=" -H 'Content-Type:application/json; charset=UTF-8'",i+=" -d@"+(t=a),j.writeFile(t,JSON.stringify(o),function(e){e?(console.log("BASE64 cache file  "+t+" is not created ^.^ "),r&&r(null,e)):(console.log("BASE64 cache file  "+t+" is created"),r({filePath:t,params:i}))})},Framework.ReadBusinessLicense=N;var W={},U=new(require("events").EventEmitter);W.subscribe=function(e,t){U.on(e,t)},W.clear4Event=function(e){U.removeAllListeners([e])},W.clearAllListeners=function(){U.removeAllListeners()},W.fireEvent=function(e){U.emit.apply(U,arguments)},W.removeListener=function(e,t){U.removeListener(e,t)},W.listeners=function(e){return U.listeners(e)},W.listenerCount=function(e){return U.listenerCount(e)},W.setMaxListeners=function(e){U.once(e,function(){U.setMaxListeners(Math.max(U.getMaxListeners(),W.listenerCount(e)+1))})},Framework.EventBus=W;var L=require("ejsexcel"),Q=require("fs"),J={writeToExcel:function(r,n){var e=Q.readFileSync(r.templateFile);L.renderExcelCb(e,r.reportData,function(e,t){if(e)return console.log("[EXCEL生成失败!]:"+e),void n(e);Q.writeFileSync(r.reportFile,t),n&&n()})}};Framework.WriteToEJSExcel=J;var G={httpGet:function(e,t,r,n){var o={host:e,path:t,port:r};require("http").request(o,function(e){e.setEncoding("utf8");var t="";e.on("data",function(e){t+=e}),e.on("end",function(){n&&n(t),console.log(t)})}).on("error",function(e){n&&n(null,e)}).end()},httpsGet:function(e,t,r){require("https").request(options,function(e){e.setEncoding("utf8");var t="";e.on("data",function(e){t+=e}),e.on("end",function(){callback&&callback(t),console.log(t)})}).on("error",function(e){r&&r(null,e),console.log("HTTS GET :"+options.host+options.pan+" error: "+JSON.stringify(e))}).end()},httpPost:function(e,t,r,n,o){var i={host:e,path:t,port:r,method:"POST"},a=require("http").request(i,function(e){e.setEncoding("utf8");var t="";e.on("data",function(e){t+=e}),e.on("end",function(){o&&o(t)})});a.on("error",function(e){o&&o(null,e)}),a.write(JSON.stringify(n)),a.end()},httpsPost:function(e,t,r){var n={host:e.host,path:e.path,port:443,method:"POST"};e.headers&&(n.headers=e.headers);var o=require("https").request(n,function(e){e.setEncoding("utf8");var t="";e.on("data",function(e){t+=e}),e.on("end",function(){r&&r(t)})});o.on("error",function(e){r&&(console.log(e),r(null,e))}),o.write(JSON.stringify(t)),o.end()}};Framework.HttpAccess=G;var Y=require("xlsx"),z=function(e,t){if(!Array.isArray(e)||!Array.isArray(t)){var r="writeToExcel cause an error! headers or data isn't an Array!";throw console.log(r),Error(r)}return t.forEach(function(r){var n=Object.getOwnPropertyNames(r);e.forEach(function(e){if(-1==n.indexOf(e)){var t="writeToExcel cause an error! "+JSON.stringify(r)+" hasn't property "+e;throw console.log(t),Error(t)}})}),!0},V=function(e,t){var r=e.map(function(e,t){var r,n=parseInt(t/26),o=t%26;return r=0<n?String.fromCharCode(65+n-1)+(String.fromCharCode(65+o)+1):String.fromCharCode(65+o)+1,Object.assign({},{v:e,position:r})}).reduce(function(e,t){var r={};return r[t.position]={v:t.v},Object.assign({},e,r)},{}),n=t.map(function(i,a){e.map(function(e,t){var r,n=parseInt(t/26),o=t%26;return r=0<n?String.fromCharCode(65+n-1)+(String.fromCharCode(65+o)+(a+2)):String.fromCharCode(65+t)+(a+2),Object.assign({},{v:i[e],position:r})})}).reduce(function(e,t){return e.concat(t)}).reduce(function(e,t){var r={};return r[t.position]={v:t.v},Object.assign({},e,r)},{}),o=Object.assign({},r,n),i=Object.keys(o),a=i[0]+":"+i[i.length-1];return Object.assign({},o,{"!ref":a})},K=function(e,t,r,n){var o={SheetNames:[],Sheets:{}};for(var i in e){var a=e[i],s=a.headers,u=a.data;if(!z(s,u))return;var c=V(s,u);if(!c)throw Error("sheet: "+i+" hasn't get SheetsJson!");o.SheetNames.push(i),o.Sheets[i]=c}var l=(t&&""!=t?t+"/"+r:r)+".xlsx";Y.writeFileAsync(l,o,function(e){n&&n(e)})},H={writeToExcel:function(e,t){if("object"!=typeof e){var r="writeToExcel cause an error! opt isn't an object!";console.log(r),t(new Error(r))}try{var n=0,o=Object.getOwnPropertyNames(e).length;for(var i in e){var a=e[i].sheets,s=e[i].direct;K(a,s,i,function(e){++n==o&&t&&t()})}}catch(e){r="writeToExcel cause an error! "+e.message;console.log(r),t(e)}}};Framework.WriteToExcel=H;M=Framework.Utilities;var X=require("cron").CronJob,Z={},$={startSyn:function(e){this.startCronJob(e)},dispose:function(){for(var e in Z)Z[e]&&(Z[e].stop(),Z[e]=null,delete Z[e]);Z={}},stopCronJob:function(e){var t=Z[e];t&&t.stop()},stopAllCronJob:function(e){for(var t in Z)this.stopCronJob(t);e&&e()},deleteAllCronJob:function(e){for(var t in Z)this.deleteCronJob(t);e&&e()},deleteCronJob:function(e,t){Z[e]&&(this.stopCronJob(e),delete Z[e]),t&&t()},startCronJob:function(t){var e=new X(t.time,function(){t.func.apply(t.global,[t.sysTaskConfig])},function(e){M.log("--------stop--------"+t.uuid+"--------"+t.prop)});(Z[t.uuid+"_"+t.prop]=e).start(),M.log("--------start--------"+t.uuid+"--------"+t.prop)}};Framework.SynServer=$;var ee=require("events"),te=require("util"),re=(M=Framework.Utilities,function(){ee.EventEmitter.call(this),this.__id=M.getGUID(11,20),this.setValue=function(e,t){var r=this[e];t!=r&&(this[e]=t,this.emit("propertyChanged",this,e,r,t))},this.getID=function(){return this.__id},this.getValue=function(e){return this[e]}});te.inherits(re,ee.EventEmitter),Framework.RTData=re;var ne=require("events"),oe=require("util"),ie=["domain","getID","getValue","setValue","_events","_eventsCount","_maxListeners","__id","setMaxListeners","getMaxListeners","emit","addListener","on","prependListener","once","prependOnceListener","removeListener","removeAllListeners","listeners","listenerCount","eventNames"],ae=function(){ne.EventEmitter.call(this),this.__index={},this.__dataArray={};var e=this;this._proxyPropertyChanged=function(){e.onDataPropertyChanged.apply(e,arguments)},this.getAllData=function(){var e=[],t=this.__dataArray;for(var r in t)e.push(t[r]);return e},this.addIntoIndex=function(e,t,r){var n=e[r];if(n&&"string"==typeof n){var o=t[n];o||(o={},t[n]=o),o[e.__id]=e}},this.removeDataFromIndex=function(e,t,r){var n=e[r],o=e.getID(),i=t[n];i&&(i[o]&&(i[o]=null,delete i[o]),0==Object.getOwnPropertyNames(i).length&&(t[n]=null,delete t[n]))},this.addData=function(e){var t=this.__dataArray;if(e&&e.getID){var r=e.getID();if(e!=t[r]){t[r]=e;var n=this.__index;if(0==Object.getOwnPropertyNames(n).length)for(var o in e)-1==ie.indexOf(o)&&this.buildIndex(o);for(var o in n){var i=n[o];this.addIntoIndex(e,i,o)}return e.on("propertyChanged",this._proxyPropertyChanged),this.emit("dataAdded",e),!0}}return!1},this.removeData=function(e){var t=this.__dataArray;if(e&&e.getID){var r=e.getID();if(e==t[r]){t[r]=null,delete t[r],e.removeAllListeners();var n=this.__index;for(var o in n){var i=n[o];-1==ie.indexOf(o)&&this.removeDataFromIndex(e,i,o)}return this.emit("dataRemoved",e),!0}}return!1},this.removeDataByID=function(e){var t=this.__dataArray;if(e){var r=t[e];if(r)return this.removeData(r),r.removeListener("propertyChanged",this._proxyPropertyChanged),!0}return!1},this.removeAllData=function(){var e=this.__dataArray;for(var t in e){var r=e[t];r&&(this.removeData(r),r.removeListener("propertyChanged",this._proxyPropertyChanged))}return 0==Object.getOwnPropertyNames(e).length},this.onDataPropertyChanged=function(e,t,r,n){var o,i=this.__index[t],a=e.getID();i?r&&(o=i[r])&&(o[a]&&(o[a]=null,delete o[a]),0==Object.getOwnPropertyNames(o).length&&(i[r]=null,delete i[r])):(i={},this.__index[t]=i);i&&((o=i[n])?o[a]=e:(i[n]={},i[n][a]=e));this.emit("dataPropertyChanged",e,t,r,n)},this.getUniqueDataBy=function(e,t){var r=this.getDataBy(e,t);return r&&0<r.length?r[0]:null},this.getDataByID=function(e){return this.__dataArray[e]},this.getDataBy=function(e,t){var r=this.__index[e],n=this.__dataArray;if(!r)for(var o in r={},this.__index[e]=r,n){var i=n[o];this.addIntoIndex(i,r,e)}var a=r[t],s=[];for(var u in a)s.push(a[u]);return s},this.buildIndex=function(e){var t=this.__index[e];t||(t={},this.__index[e]=t)}};oe.inherits(ae,ne.EventEmitter),Framework.DataContainer=ae;var se=function(){};(M=Framework.Utilities).extend(se,Object,{getCapabilities:function(){return[]},run:function(e,t){this[e]&&this[e].apply(this,t)},setupConfig:function(e){}}),Framework.Middleware=se;var ue=function(){this._mws={},this._mwmc={},this.focusEvents=[]};(M=Framework.Utilities).extend(ue,Object,{getPath:function(e){return"../"+e+"/"},loadDBSettings:function(e,t){if(t)var r=require("./g").General[t].Model;else if(e.name){var n=e.name.split("."),o=require(e.url);if(1<n.length)r=o[n[0]][n[1]].Model;else r=o[e.name].Model}else r=require(this.getPath(e.url)+"models").Model;this.Model=r},runningOnPlatform:function(e){this._platform=e},preRunningOnPlatform:function(){},loadModuleSettings:function(e){},replyHeartbeat:function(e){return null},releaseSession:function(e){},loadMiddlewares:function(e){if(e){var t=this._mws;for(var r in e){var n=e[r],o=null,i=null;if("string"==typeof n?o=n:(o=n.path,i=n.config),o){var a=new(require(o));(t[r]=a)._platform=this._platform,a.setupConfig(i);for(var s=a.getCapabilities(),u=this._mwmc,c=0;c<s.length;c++)u[s[c]]=a}}}},findMiddlewareByMethod:function(e){return this._mwmc[e]},middlewareWork:function(e,t){var r=this._mwmc[e];r&&r[e].apply(this,t)},disposeModule:function(e){},fireEvent:function(e,t,r){e=this._platform.runModule("event","createEvent",arguments);this._platform.runModule("event","addEvents",[e,t,r])},getExports:function(){}}),Framework.Module=ue;M=Framework.Utilities;var ce=Framework.SequelizeModel,le=require("util"),fe=Framework.Module,de=function(){M.callSuper(de,this,arguments),this.timeoutIDForModel=void 0,this.recordsForModel={},this.autoSaveTime=5e3};M.extend(de,fe,{checkRecords:function(e,t,r,n){this.rtRecords=t,this.cachedRecords=this.rtRecords.concat(),this.modelName=e,this.nextIndex=this.rtRecords.length;var o=this;this.cachedRecords&&0<this.cachedRecords.length?(M.log("AutoSaveDBModule prepare to save records: modelName:"+this.modelName+" data: "+JSON.stringify(this.cachedRecords)),ce.batchInsert(this.modelName,this.cachedRecords,function(e){r.recordsForModel[o.modelName]=r.recordsForModel[o.modelName].slice(o.nextIndex),n(!0)},function(e){console.log("error:"+e.message+"(AutoSaveDBModule prepare to save records: modelName:"+o.modelName+" data: "+JSON.stringify(o.cachedRecords)+")"),n(!1)})):n(!1)},checkRecordsForModel:function(){var e=this.recordsForModel,r=this,n=function(){r.checkRecordsForModel()},o=Object.getOwnPropertyNames(e).length,i=0,a=[];if(0<o)for(var t in e){var s=e[t].concat(),u=new this.checkRecords(t,s,this,function(e){if(++i==o){r.timeoutIDForModel=setTimeout(n,r.autoSaveTime);for(var t=0;t<a.length;t++)a[t]=null}});a.push(u)}else r.timeoutIDForModel=setTimeout(n,r.autoSaveTime)},addRecordsForModels:function(e,t,r,n){le.isArray(t)||(t=[t]),this.recordsForModel[e]?this.recordsForModel[e]=this.recordsForModel[e].concat(t.concat()):this.recordsForModel[e]=t.concat(),r&&r(t)},updateRecordsForModels:function(n,o,i,e,a,t){le.isArray(o)||(o=[o]);var s=[],u=this;if(this.recordsForModel[n]){s=s.concat(this.recordsForModel[n]);for(var r=0;r<s.length;r++)s[r][i]!=e&&(s.splice(r,1),this.recordsForModel[n].splice(r,1),r--)}var c={};c[i]=e,ce.query(n,{where:c},function(e){for(var t=0;t<e.length;t++)e[t]=e[t].dataValues;s=s.concat(e);for(t=0;t<s.length;t++)for(var r=0;r<o.length;r++)if(s[t][i]==o[r][i]){s.splice(t,1),t--;break}o=o.concat(s),ce.delete(n,c,function(e){u.recordsForModel[n]?u.recordsForModel[n]=u.recordsForModel[n].concat(o):u.recordsForModel[n]=o,a&&a(o)},function(e){console.log("error:"+e.message)})},function(e){console.log("error:"+e.message)})},initAutoSaveDBModule:function(){this.checkRecordsForModel()},runningOnPlatform:function(e){M.invokeSuper(de,"runningOnPlatform",this,arguments),this.initAutoSaveDBModule()},disposeModule:function(){M.invokeSuper(de,"disposeModule",this,arguments),clearTimeout(this.timeoutIDForModel)}}),Framework.AutoSaveDBModule=de;M=Framework.Utilities;var he=Framework.EventBus,ge=Framework.AutoSaveDBModule,pe=function(){M.callSuper(pe,this,arguments),this.focusedEventArray={}};M.extend(pe,ge,{initEventModule:function(){if(this.focusedEventArray)for(var t=this,e=0;e<this.focusedEventArray.length;e++){!function(e){he.subscribe(e.event,function(){t[e.onEvent].apply(t,arguments)})}(this.focusedEventArray[e])}},runningOnPlatform:function(e){M.invokeSuper(pe,"runningOnPlatform",this,arguments),this.initEventModule()},disposeModule:function(){if(M.invokeSuper(pe,"disposeModule",this,arguments),this.focusedEventArray)for(var e=0;e<this.focusedEventArray.length;e++){var t=this.focusedEventArray[e];he.removeListener(t.event,this[t.onEvent])}}}),Framework.EventModule=pe;M=Framework.Utilities;var ve=Framework.RTData,me=Framework.EventModule,ye=Framework.DataContainer,be=function(){M.callSuper(be,this,arguments),this.DataContainerArray=[]};M.extend(be,me,{getAllContainerData:function(e){return this[e].getAllData()},getContainerDataByPro:function(e,t,r){return this[e].getDataBy(t,r)},getContainerDataByPros:function(e,t,r){var n=this[e].getDataBy(t[0].pro,t[0].value);if(1<t.length)for(var o=0;o<n.length;o++){for(var i=1,a=1;i<t.length;i++)r?-1<n[o][t[i].pro].indexOf(t[i].value)&&a++:n[o][t[i].pro]==t[i].value&&a++;a!=t.length&&(n.splice(o,1),o--)}return n},getUniqueContainerDataByPro:function(e,t,r){return this[e].getUniqueDataBy(t,r)},addContainerData:function(e,t){t instanceof Array||(t=[t]);for(var r=0;r<t.length;r++){var n=new ve;if(M.copySimpleObject(t[r],n),!this[e].addData(n))break}return r==t.length},removeContainerData:function(e,t,r){var n=this.getContainerDataByPro(e,t,r);n instanceof Array||(n=[n]);for(var o=0;o<n.length&&this[e].removeData(n[o]);o++);return o==n.length},removeAllContainerData:function(e){return this[e].removeAllData()},updateContainerData:function(e,t,r,n){var o=this[e].getUniqueDataBy(t,r);if(o){for(var t in n)o.setValue(t,n[t]);return!0}return!1},initRTDataModule:function(){if(this.DataContainerArray)for(var e=0;e<this.DataContainerArray.length;e++){this[this.DataContainerArray[e]]=new ye}},runningOnPlatform:function(e){M.invokeSuper(be,"runningOnPlatform",this,arguments)},preRunningOnPlatform:function(){M.invokeSuper(be,"preRunningOnPlatform",this,arguments),this.initRTDataModule()},disposeModule:function(){M.invokeSuper(be,"disposeModule",this,arguments);var e=this.DataContainerArray;if(e)for(var t=0;t<e.length;t++)this[e[t]]=null}}),Framework.RTDataModule=be;M=Framework.Utilities;var Se=require("fs"),we=(n=Framework.Consts).ActionStatus,Ee=n.ErrorCode,Ce=function(e,t,r){if(t&&t instanceof Array)for(var n=0;n<t.length;n++){var o=t[n],i=o.path,a=o.router,s="string"==typeof(c=a)?require(c):c;if(s)if(r){var u=s(r);e.use(i,u)}else{u=s({});e.use(i,u)}}var c},Me=function(e,t){require("socket.io")(e).on("connection",t||function(e){console.log("default websocket connected! ")})},Ae=function(e,t,r){console.log("recieved requirement "+JSON.stringify(e.originalUrl)),r()},Fe=function(e){if("listen"!==e.syscall)throw e;var t="Port "+e.port;switch(e.code){case"EACCES":console.error(t+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(t+" is already in use"),process.exit(1);break;default:throw e}},De=function(){console.log("WebService is inited ......")},ke=function(e){this.init(e)};M.extend(ke,Object,{init:function(e){var t,r,n,o=require("express"),i=o();t=i,r=require("cookie-parser"),n=require("body-parser"),t.use(n.json({limit:"50mb"})),t.use(n.urlencoded({limit:"50mb",extended:!0,parameterLimit:1e8})),t.use(r());i.disable("x-powered-by");var a,s,u=e.httpOption;(u.compression&&(a=i,s=require("compression"),a.use(s())),u.crossDomain&&i.all("*",function(e,t,r){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Credentials","true"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.header("Access-Control-Allow-Methods","PUT,POST,GET,DELETE,OPTIONS"),"OPTIONS"==e.method?t.send(200):r()}),e.sessionOption)&&function(e,t){var r=require("express-session"),n={key:t.key||"session_cookie_name",secret:t.secret||"session_cookie_secret",resave:!0,saveUninitialized:!0};if("mysql"==t.dialect){var o={host:t.dbhost,port:t.dbport,user:t.dbuser,password:t.dbpassword,database:t.database,checkExpirationInterval:t.interval||2e4,expiration:t.expiration||72e5,createDatabaseTable:!0,schema:{tableName:t.sessionTable||"sessions",columnNames:{session_id:"session_id",expires:"expires",data:"data"}},useConnectionPooling:!0},i=new(require("express-mysql-session"))(o);n.store=i}else if("mssql"==t.dialect){var a=require("connect-mssql")(r),s={user:t.dbuser,password:t.dbpassword,server:t.dbhost,database:t.database,options:{encrypt:!1}};n.store=new a(s,{table:"sessions",ttl:72e5})}e.use(r(n))}(i,e.sessionOption);u.withLog&&function(e,t){var r=require("morgan"),n=require("file-stream-rotator");t=t||"./log";Se.existsSync(t)||Se.mkdirSync(t);var o=n.getStream({date_format:"YYYYMMDD",filename:t+"/access-%DATE%.log",frequency:"daily",verbose:!1});e.use(r("dev",{stream:o}))}(i,e.logDirectory),e.log4jsConfig&&function(e,t){var r=require("log4js");if(t.logflag){r.configure({appenders:{console:{type:"console"},Compliance:{type:"dateFile",filename:t.logpath+"log",pattern:"-yyyy-MM-dd.txt",category:"Compliance",alwaysIncludePattern:!0}},categories:{default:{appenders:["console","Compliance"],level:"warn"}}});var n=r.getLogger("Compliance");console.log=n.warn.bind(n),e.use(r.connectLogger(n))}}(i,e.log4jsConfig);var c,l,f,d,h,g,p,v,m,y=!!e.EnableClusterLoad&&e.EnableClusterLoad,b=require("cluster"),S=require("os").cpus().length;if(e.routeGateway?i.use(e.routeGateway):i.use(Ae),u.publicPath&&(c=i,l=o,f=u,d=require("path"),h=require("serve-favicon"),g=f.publicPath,p=f[404],v=f.index||"index.html",c.use(l.static(d.join(__dirname,"",g),{index:!1})),c.use("/404",l.static(d.join(__dirname,"",p),{index:!1})),c.set("views",d.join(__dirname,"",g)),c.engine(".html",require("ejs").renderFile),c.set("view engine","html"),c.get("/",function(e,t){t.render(v)}),c.use(h(d.join(__dirname,g,"favicon.icon")))),e.routers&&Ce(i,e.routers,y?b:null),(m=i).use(function(e,t,r){var n=new Error("Not Found");n.status=404,r(n)}),"development"===m.get("env")&&m.use(function(e,t,r,n){var o=e.status||500;404==o?"GET"==t.method?r.redirect("/404/404.html"):r.status(o).json({status:we.F,error:{cause:t.originalUrl+" : "+Ee[100100]}}):n(e)}),m.use(function(e,t,r,n){var o=e.status||500;r.status(o).json({status:we.F,error:{cause:e.message}})}),process.on("uncaughtException",function(e){console.error("uncaughtException ERROR"),"object"==typeof e?(e.message&&console.error("ERROR: "+e.message),e.stack&&console.error(e.stack)):console.error("argument is not an object")}),y)if(b.isMaster){console.log("[master] start master...");for(var w=0;w<S;w++)b.fork();b.on("listening",function(e,t){console.log("[master] listening: worker"+e.id+",pid:"+e.process.pid+", Address:"+t.address+":"+t.port)})}else console.log("[worker] start worker ..."+b.worker.id),this.startWebServer(e,u,i);else this.startWebServer(e,u,i)},startWebServer:function(e,t,r){var n,o,i,a,s,u,c,l,f;e.httpsOption||"https"==t.type?this._server=(a=r,s=e,u=require("https"),c=s.httpOption,l={key:Se.readFileSync(c.privateKeyPath,"utf8"),cert:Se.readFileSync(c.certificatePath,"utf8")},(f=u.createServer(l,a)).on("error",s.onError||Fe),f.on("listening",s.onSuccess||De),f.listen(s.httpOption.port||443,"0.0.0.0"),f):this._server=(n=r,o=e,(i=require("http").createServer(n)).on("error",o.onError||Fe),i.on("listening",o.onSuccess||De),i.listen(o.httpOption.port||80,"0.0.0.0"),i),e.websocket&&Me(this._server,e.onConnection)},getServer:function(){return this._server},stopServer:function(e){this._server&&this._server.close(e)}}),Framework.WebService=ke;var Te=function(){};(M=Framework.Utilities).extend(Te,Object,{start:function(e){var t=this;this.running?this.stop(function(){t.startWebservice(e)}):t.startWebservice(e)},startWebservice:function(e){var t=M.copySimpleObject(e,{}),r=Framework.WebService;this.webservice=new r(t)},stop:function(){this.running=!1,this.webservice&&this.webservice.stop()}}),Framework.BaseServer=Te;M=Framework.Utilities;var qe=Framework.BaseServer,Oe=(we=(n=Framework.Consts).ActionStatus,Ee=n.ErrorCode,function(){M.callSuper(Oe,this,arguments)});M.extend(Oe,qe,{bindPlatform:function(e){this.platform=e},attachPlatform:function(e){this.platform=e},start:function(e){M.invokeSuper(Oe,"start",this,[e])},getNoMethodReply:function(e,t){return{status:we.F,error:{cause:Ee[100100]}}},getUnauthorized:function(e,t){return{status:we.F,error:{code:"100050",cause:Ee[100050],message:t+"["+e+"] is unauthorized"}}},getLogOverTime:function(){return{status:we.F,error:{cause:Ee[100005]}}},getWithoutLogIn:function(){return{status:we.F,error:{code:"100003",cause:Ee[100003]}}},getModuleRouter:function(e){var t=require("express").Router(),v=this.platform,m=this;return t.use("/:module/:api",function(e,h,g,p){var t=M.getNodeClientIp(h);m.platform.runModule("auth","isAvaliableIp",[t,function(e,t){if(t=!m.platform._systemConfig.ipWhiteCheck||t,e)g.json(e);else if(t){var r=g.json;g.json=function(){var e=h.session?h.session.user:null,t=arguments[0];e&&e.token&&(t.token=e.token),r.apply(this,[t])};var n,a=v.getModule("auth"),o=h.params,s=o.module,u=o.api,c=(h.method,h.session),i=c.user,l=function(e){if("getCapabilities"==u){var t=v.getCapabilities();g.json({type:"getCapabilities",result:t,status:we.S})}else{var r=!0;if(!m.isExceptApi(s,u))if(c.islogin)a.isValidate(u,s,e)||(r=!1,g.json(m.getUnauthorized(u,s)));else{r=!1;var n=h.cookies;if(n.account)if(n.account.aid){var o=v.getModule("account");o.autoLogin?o.autoLogin(h,g,n.account.aid,function(){g.json(m.getWithoutLogIn())}):g.json(m.getWithoutLogIn())}else g.json(m.getWithoutLogIn());else g.json(m.getWithoutLogIn())}if(r){var i=v.getModule(s);i&&i[u]?i[u](h,g,p):g.json(m.getNoMethodReply())}}};if(i)n=i.rolekey||i.rolevalue,l(n);else{var f=h.body,d=f.appKey;f.token?a.getTokenByKey(f.token,function(e,t){t?(h.session.user=t.user,h.session.islogin=!0,n=t.rolevalue,l(n)):l()}):d?a.getUserByAppKey(d,function(e,t){n=t.rolevalue,h.session.user=t,h.session.islogin=!0},l):l()}}else g.json({status:we.F,error:{cause:Ee[100060],message:Ee[100060]}})}])}.bind(this,e)),t},loadDBSettings:function(e){},createToken:function(e){},getGateway:function(t,r,n){var o=this,e=this.platform,i=t.session,a=function(){var e=o.platform._settings.loginPage;"GET"==t.method?o.isExceptPage(t.originalUrl)?n():r.redirect(e):n()};if(i)if(i.islogin)n();else{var s=t.body.token;if(s){var u=e.getModule("auth"),c=M.getNodeClientIp(t);u.isValidateTokenAtAuth(s,c,function(e,t){e?console.log("mainServer-getGateway:"+e):t?n():a()})}else a()}},isExceptPage:function(e){var t=this.platform._settings,r=t.moduleSettings.auth.publicPages;if(t.weserviceSettings.httpOption.authResourcesPath&&0<=e.indexOf(t.weserviceSettings.httpOption.authResourcesPath))return!1;if(!r)return!1;for(var n=0;n<r.length;n++)if(0<=e.indexOf(r[n]))return!0;return!(0<=e.indexOf("/module/"))&&e.indexOf(".html")<0},isExceptApi:function(e,t){var r=this.platform._settings.moduleSettings.auth.publicApi[e];if(!r)return!1;if("*"==r)return!0;for(var n=0;n<r.length;n++)if(r[n]==t)return!0;return n!=r.length&&void 0},startWebservice:function(e){var n=this;e||(e={}),e.sessionOption=M.setWithDefaultRef(e.sessionOption,{dbhost:"localhost",dbport:3306,dbuser:"root",dbpassword:"rabbityun",database:"RabbitSaas"}),e.httpOption=M.setWithDefaultRef(e.httpOption,{type:"http",port:1e4,crossDomain:!0,compression:!0,publicPath:"../libs/public",index:"login.html",404:"../libs/404"}),e.routeGateway=function(e,t,r){n.getGateway(e,t,r)},e.routers=[{path:"/module",router:n.getModuleRouter.bind(n)}],e.onSuccess=function(){console.log("程序已启动,监听端口:"+e.httpOption.port+" 请访问: "+e.httpOption.type+"://localhost:"+e.httpOption.port+"/")},M.invokeSuper(Oe,"startWebservice",this,[e])}}),Framework.MainServer=Oe;M=Framework.Utilities;Framework.platform=function(e,t){var r=t.dbConfig,n=t.systemConfig,o=t.operator;(this._systemConfig=t).logging&&M.enableDebug(),this._modules={},this._settings=e,this.dbConfig=r,this.systemConfig=n,this.operator=o,this.startServer=function(e){var t;if(e);else{var r=this._settings;r&&r.server&&((t=new Framework[r.server]).bindPlatform(this),t.start(r.weserviceSettings))}return t&&(this._main=t),t},this.getModule=function(e){return this._modules[e]},this.addModule=function(e,t){this._modules[e]=t},this.loadModule=function(e,t,r){if(r)var n=require("./g").General[r].Module;else if(t.name){var o=t.name.split("."),i=require(this._settings.modulePathPrefix+t.url);t.url=this._settings.modulePathPrefix+t.url,n=1<o.length?i[o[0]][o[1]].Module:i[t.name].Module}else n=require(this._settings.modulePathPrefix+t.url+"/Module");var a=new n;a.loadDBSettings(t,r),this.addModule(e,a)},this.loadConfigure=function(r){var n=this;this.loadModule("setting",null,"Setting"),this.sequelizeModel.onReady(function(){var t=n._modules.setting;t&&t.initSetting(n._settings,function(e){n._settings=e,t.runningOnPlatform(n),r&&r()})})},this.registerSysSettings=function(){var e=Framework.Utilities;this.sequelizeModel=e.loadSingleInstance("sequelizeModel","./dao/sequelizeModel","SequelizeModel"),this.sequelizeModel.init(this.dbConfig),e.loadSingleInstance("EventBus","./EventBus","EventBus")},this.loadGeneralModules=function(){if(this._settings){var e=this._settings.generalModules;if(!e)return;for(var t in e)this.loadModule(t,null,e[t])}},this.loadModules=function(){if(this._settings){var e=this._settings.modules;if(!e)return;for(var t in e)this.loadModule(t,e[t])}},this.loadMiddlewares=function(e,t){e&&t&&e.loadMiddlewares(t)},this.installModules=function(){if(this._settings){var e=this._modules;for(var t in e)(o=this._modules[t])&&o.preRunningOnPlatform();if(!e)return;var r=this._settings.middlewares,n=this._settings.moduleSettings;for(var t in e){var o;if(o=this._modules[t]){if(o.runningOnPlatform(this),n){var i=n[t];i&&o.loadModuleSettings(i,"init")}if(r){var a=r[t];a&&this.loadMiddlewares(o,a)}}}}},this.prepareEnv=function(){var e=this;this.registerSysSettings(),this.loadConfigure(function(){e.loadGeneralModules(),e.loadModules(),e.sequelizeModel.onReady(function(){e.installModules(),e.startServer()})})},this.findFunctionModule=function(e){var t=this._modules;for(var r in t)if(t[r][e])return t[r];return null},this.runModule=function(e,t,r){var n=this.getModule(e);if(n&&n[t])return n[t].apply(n,r);var o="runModule: "+e+" method: "+t+" cause an error: no moduleName or no method!";return console.log(o),{status:"0",error:new Error(o)}},this.run=function(e,t){var r=this.findFunctionModule(e);r&&r[e].apply(r,t)},this.init=function(){this.prepareEnv()},this.collectHBReply=function(e){var t=[];for(var r in this._modules){var n=this._modules[r].replyHeartbeat(e);n&&t.push(n)}return t},this.releaseSession=function(e){for(var t in this._modules)this._modules[t].releaseSession(e)},this.getCapabilities=function(){var e=this._modules,t={};for(var r in e){var n=e[r],o=n._name;t[o]=[];var i=n.getExports();i&&(t[o]=i)}return t},this.disposeModule=function(e){this._modules[e].disposeModule(),delete this._modules[e]}}}(),exports.Framework=Framework;
